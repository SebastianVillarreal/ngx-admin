<div class="row">
  <div class="col-12">
    <nb-card>
      <nb-card-header>Pagos Spei | Filtros</nb-card-header>
      <nb-card-body>
        <div class="row g-3">
          <div class="col-md-3 col-lg-3">
            <label class="label" for="fi">*Fecha Inicial:</label>
            <input nbInput id="fi" fullWidth placeholder="dd/mm/aaaa" [nbDatepicker]="dpi" [formControl]="form.controls.fechaInicial">
            <nb-datepicker #dpi></nb-datepicker>
          </div>
          <div class="col-md-3 col-lg-3">
            <label class="label" for="ff">*Fecha Final:</label>
            <input nbInput id="ff" fullWidth placeholder="dd/mm/aaaa" [nbDatepicker]="dpf" [formControl]="form.controls.fechaFinal">
            <nb-datepicker #dpf></nb-datepicker>
          </div>
          <div class="col-md-3 col-lg-3 d-flex align-items-end">
            <button nbButton status="primary" (click)="buscar()" [disabled]="loading">
              {{ loading ? 'Buscando…' : 'Buscar' }}
            </button>
          </div>
        </div>
      </nb-card-body>
    </nb-card>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <nb-card>
      <nb-card-header>Pagos Spei | Tabla</nb-card-header>
      <nb-card-body>
        <div class="d-flex justify-content-between flex-wrap mb-3">
          <div class="d-flex align-items-center gap-2">
            <button nbButton size="small" status="success" (click)="exportExcel()">Exportar a Excel</button>
            <span class="ms-3">Mostrar</span>
            <nb-select size="small" [selected]="pageSize" (selectedChange)="pageSize = $event; page = 1;" style="width: 90px;">
              <nb-option *ngFor="let s of pageSizes" [value]="s">{{ s }}</nb-option>
            </nb-select>
            <span>registros</span>
          </div>
          <div class="d-flex align-items-center">
            <span class="me-2">Buscar:</span>
            <input nbInput placeholder="" style="max-width: 240px;" [(ngModel)]="search" (ngModelChange)="page = 1">
          </div>
        </div>

        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th (click)="setSort('numero')" class="sortable">Número</th>
                <th (click)="setSort('proveedor')" class="sortable">Proveedor</th>
                <th (click)="setSort('total')" class="sortable">Total</th>
                <th (click)="setSort('sucursal')" class="sortable">Sucursal</th>
                <th (click)="setSort('folio')" class="sortable">Folio</th>
                <th (click)="setSort('referenciaBanco')" class="sortable">Referencia Banco</th>
                <th (click)="setSort('fecha')" class="sortable">Fecha</th>
                <th style="width: 260px;"></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let r of pageRows">
                <td>{{ r.numero }}</td>
                <td>{{ r.proveedor }}</td>
                <td>{{ r.total | currency:'MXN':'symbol':'1.2-2' }}</td>
                <td>{{ r.sucursal }}</td>
                <td>{{ r.folio }}</td>
                <td>{{ r.referenciaBanco }}</td>
                <td>{{ r.fecha }}</td>
                <td>
                  <button nbButton size="tiny" status="info" (click)="editar(r)" class="me-1">Editar</button>
                  <button nbButton size="tiny" status="primary" (click)="detalle(r)" class="me-1">Detalle</button>
                  <button nbButton size="tiny" status="success" (click)="comprobante(r)" class="me-1">Comprobante</button>
                  <button nbButton size="tiny" status="danger" (click)="eliminar(r)">Eliminar</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-2">
          <div>
            Mostrando registros del {{ (page - 1) * pageSize + (displayedCount ? 1 : 0) }} al {{ (page - 1) * pageSize + displayedCount }} de un total de {{ totalCount }} registros
          </div>
          <div class="d-flex gap-2">
            <button nbButton size="tiny" [disabled]="page<=1" (click)="gotoPage(page-1)">Anterior</button>
            <input nbInput type="number" [value]="page" (change)="gotoPage(+$any($event.target).value)" style="width: 60px; text-align: center;">
            <button nbButton size="tiny" [disabled]="page>=totalPages" (click)="gotoPage(page+1)">Siguiente</button>
          </div>
        </div>

      </nb-card-body>
    </nb-card>
  </div>
</div>
